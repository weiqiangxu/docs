---
title: 上下文易错点
tags:
  - golang
categories:
  - golang
---

# 实例代码

> 解释一下WithTimeout的cancel是否要直接defer

```golang
package main

import (
	"context"
	"fmt"
	"time"
)

func ccc() context.Context {
	ctx, cancel := context.WithTimeout(context.Background(), 4*time.Second)
    // defer会在ccc执行完成以后立即调用
    // 从而导致直接触发<-ctx.Done
    // 无法等到timeOut后触发
	defer cancel()
	return ctx
}

func main() {
	ctx := ccc()
	select {
	case <-ctx.Done():
		fmt.Println("Context done.")
	case <-time.After(3 * time.Second):
		fmt.Println("Timeout after 3 seconds.")
	}
}
```